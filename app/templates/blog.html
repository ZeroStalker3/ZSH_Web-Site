<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ë–ª–æ–≥ ‚Äî ZSH</title>
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º CSS –¥–ª—è —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/themes/' + theme + '.css') }}">
  
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: var(--bg, #000); /* fallback ‚Äî —á—ë—Ä–Ω—ã–π */
      color: var(--text, #fff);     /* fallback ‚Äî –±–µ–ª—ã–π */
      overflow-x: hidden;
      overflow-y: auto;
      transition: filter 0.5s ease;
    }

    canvas#bg {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      display: block;
    }

    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö–µ–¥–µ—Ä */
    header {
      box-sizing: border-box;
      top: 0; left: 0;
      width: 100%;
      background: var(--header-bg, rgba(0, 0, 0, 0.85));
      padding: 1rem 2rem;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 1.5s ease, rotate 1.5s ease;
      transform-origin: top center;
      box-shadow: 0 0 10px var(--accent-shadow, #7f5af0aa);
    }

    nav a {
      color: var(--text, white);
      margin: 0 1rem;
      text-decoration: none;
      position: relative;
      user-select: none;
      transition: color 0.3s ease;
    }

    nav a:hover::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      background: var(--accent, #7f5af0);
      bottom: -4px;
      left: 0;
    }
    nav a:hover {
      color: var(--accent, #7f5af0);
    }

    main {
      position: relative;
      z-index: 10;
      max-width: 900px;
      margin: 5rem auto 2rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.65);
      border-radius: 10px;
      box-shadow: 0 0 20px var(--accent-shadow, #7f5af0aa);
      min-height: 80vh;
    }

    h1 {
      text-align: center;
      font-size: 2.7rem;
      margin-bottom: 2rem;
      color: var(--accent, #7f5af0);
      animation: glitch 2s infinite;
      user-select: none;
    }

    @keyframes glitch {
      0% { text-shadow: 2px 2px #ff00c8, -2px -2px #00fff7; }
      25% { text-shadow: -3px 2px #ff00c8, 2px -3px #00fff7; }
      50% { text-shadow: 2px -3px #ff00c8, -3px 3px #00fff7; }
      75% { text-shadow: -2px 3px #ff00c8, 3px -2px #00fff7; }
      100% { text-shadow: 0 0 #ff00c8, 0 0 #00fff7; }
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
      user-select: none;
    }
    .controls input, .controls select {
      padding: 0.5rem 1rem;
      background: #1a1a1a;
      color: var(--accent, #7f5af0);
      border: 1px solid var(--accent, #7f5af0);
      border-radius: 5px;
      font-size: 1rem;
      outline-offset: 2px;
      transition: border-color 0.3s ease;
    }
    .controls input:focus, .controls select:focus {
      border-color: #ff00c8;
    }

    .post {
      background: var(--bg, #000);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 15px var(--accent-shadow, #7f5af0aa);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: default;
      user-select: text;
    }
    .post:hover {
      transform: scale(1.03);
      box-shadow: 0 0 40px var(--accent-shadow, #7f5af0aa);
    }
    .post h2 {
      color: var(--accent, #7f5af0);
      margin-bottom: 0.25rem;
      user-select: text;
    }
    .post .date, .post .topic {
      font-size: 0.9rem;
      color: var(--accent-shadow, #aaa);
      margin-bottom: 0.5rem;
      user-select: text;
    }
    .post p {
      font-size: 1rem;
      color: var(--text-secondary, #ccc);
      line-height: 1.5;
      user-select: text;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–∞—Å—Ö–∞–ª–∫–∏ */
    #easter-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 320px;
      max-width: 90vw;
      background: #111;
      border: 2px solid #7f5af0;
      color: white;
      padding: 2rem 2.5rem;
      z-index: 10000;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 0 40px #7f5af0cc;
      transform: translate(-50%, -50%);
      user-select: none;
      animation: modalFadeIn 0.5s ease forwards;
    }
    #easter-modal.show {
      display: block;
    }
    #easter-modal h2 {
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }
    #easter-modal p {
      font-size: 1.1rem;
      margin-bottom: 1.5rem;
      color: #ccc;
    }
    #easter-modal button {
      margin: 0 0.5rem;
      padding: 0.5rem 1.5rem;
      border: none;
      background: #7f5af0;
      color: black;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
      font-size: 1rem;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #easter-modal button:hover {
      background-color: #ff00c8;
      color: white;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translate(-50%, -45%) scale(0.8);}
      to { opacity: 1; transform: translate(-50%, -50%) scale(1);}
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç—ã –ø–∞—Å—Ö–∞–ª–∫–∏ */
    .glitch-shake {
      animation: glitch-shake 2.5s ease-in-out infinite;
    }
    @keyframes glitch-shake {
      0%, 100% { transform: translate(0) rotate(0deg); }
      10% { transform: translate(-12px, 7px) rotate(-5deg); }
      20% { transform: translate(15px, -8px) rotate(4deg); }
      30% { transform: translate(-10px, 10px) rotate(-6deg); }
      40% { transform: translate(13px, -13px) rotate(5deg); }
      50% { transform: translate(-15px, 15px) rotate(-8deg); }
      60% { transform: translate(12px, -12px) rotate(6deg); }
      70% { transform: translate(-7px, 7px) rotate(-4deg); }
      80% { transform: translate(0, 0) rotate(3deg); }
      90% { transform: translate(3px, -3px) rotate(-2deg); }
    }

    /* –ü–∞–¥–µ–Ω–∏–µ –∏ –Ω–∞–∫–ª–æ–Ω —à–∞–ø–∫–∏ */
    .header-fall {
      animation: headerFall 2s forwards;
      animation-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    @keyframes headerFall {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(60vh) rotate(10deg); }
      100% { transform: translateY(100vh) rotate(15deg); }
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - –º–µ–ª–∫–∏–µ —Å–¥–≤–∏–≥–∏ */
    .post.glitch-effect {
      animation: postGlitch 0.3s ease-in-out infinite alternate;
      box-shadow: 0 0 40px #ff00c8;
    }
    @keyframes postGlitch {
      0% { transform: translate(0, 0) skew(0deg, 0deg); }
      50% { transform: translate(-3px, 2px) skew(-2deg, 2deg); }
      100% { transform: translate(3px, -2px) skew(2deg, -2deg); }
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç –≥–ª–∏—Ç—á–∞ —Ñ–æ–Ω–∞ */
    @keyframes glitchOverlayAnim {
      0%, 100% {
        background-position: 0 0, 0 0;
      }
      50% {
        background-position: 20px 20px, -20px -20px;
      }
    }

    /* –ê–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 600px) {
      main {
        margin: 7rem 1rem 2rem;
        padding: 1rem;
      }
      .controls {
        flex-direction: column;
        gap: 0.75rem;
      }
      nav a {
        margin: 0 0.5rem;
      }
    }
  </style>
</head>
<body>

<canvas id="bg"></canvas>

<header id="header">
  <div><strong>ZSH</strong></div>
    <nav>
      <a href="{{ url_for('main.index') }}" tabindex="1">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="{{ url_for('main.about') }}" tabindex="2">–û –Ω–∞—Å</a>
      <a href="{{ url_for('main.blog') }}" tabindex="3">–ë–ª–æ–≥</a> 
      <a href="{{ url_for('main.roadmap') }}" tabindex="4">–ö–∞—Ä—Ç–∞ —Ä–∞–∑–≤–∏—Ç–∏—è</a>
      <a href="{{ url_for('main.contact') }}" tabindex="5">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('main.profile') }}">–ü—Ä–æ—Ñ–∏–ª—å</a>
        {% if current_user.is_admin %}
          <a href="{{ url_for('main.admin') }}">–ê–¥–º–∏–Ω</a>
        {% endif %}
        <a href="{{ url_for('main.logout') }}">–í—ã–π—Ç–∏</a>
      {% else %}
        <a href="{{ url_for('main.login') }}">–í–æ–π—Ç–∏</a>
      {% endif %}
    </nav>
</header>

<main>
  <h1>–ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h1>

  <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
  <form method="GET" class="controls" id="filtersForm" aria-label="–§–∏–ª—å—Ç—Ä—ã –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π">
    <input
      type="text"
      name="q"
      id="search"
      placeholder="–ü–æ–∏—Å–∫..."
      aria-label="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É"
      value="{{ search }}"
      autocomplete="off"
    />

    <select name="topic" id="topicFilter" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–º–µ">
      <option value="">–í—Å–µ —Ç–µ–º—ã</option>
      <option value="–û–±–Ω–æ–≤–ª–µ–Ω–∏—è" {% if topic == "–û–±–Ω–æ–≤–ª–µ–Ω–∏—è" %}selected{% endif %}>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</option>
      <option value="–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" {% if topic == "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" %}selected{% endif %}>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
      <option value="–°–æ–±—ã—Ç–∏—è" {% if topic == "–°–æ–±—ã—Ç–∏—è" %}selected{% endif %}>–°–æ–±—ã—Ç–∏—è</option>
    </select>

    <input
      type="date"
      name="date"
      id="dateFilter"
      value="{{ date }}"
      aria-label="–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ"
    />
  </form>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–æ—Å—Ç–∞–º–∏ -->
  <div id="blog-container" role="list" aria-live="polite" tabindex="0">
    {% if posts %}
      {% for post in posts %}
        <article class="blog-post" role="listitem" style="margin-bottom: 40px; padding: 20px; border-bottom: 1px solid #444;">
          <h2 style="color: var(--accent, #7f5af0);">{{ post.title }}</h2>
          <p style="font-size: 0.9rem; color: #aaa;">üïí {{ post.date_created.strftime('%d.%m.%Y %H:%M') }}</p>
          <div style="color: #ddd;">{{ post.content | safe }}</div>
          <p style="font-size: 0.85rem; color: #666;">–¢–µ–º–∞: {{ post.topic }}</p>
          <p style="font-size: 0.85rem; color: #666;">–ê–≤—Ç–æ—Ä: {{ post.author.username }}</p>
        </article>
      {% endfor %}
    {% else %}
      <p>–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
  </div>
</main>

<div id="easter-modal" role="dialog" aria-modal="true" aria-labelledby="easter-title" aria-describedby="easter-desc">
  <h2 id="easter-title">üëæ –ü–∞—Å—Ö–∞–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞!</h2>
  <p id="easter-desc">–¢—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º. –≠–∫—Ä–∞–Ω –≥–ª—é—á–∏—Ç –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–∑—Ä—É—à–∞–µ—Ç—Å—è.</p>
  <button id="github-btn" type="button">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ GitHub</button>
  <button id="close-easter" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
  const form = document.getElementById('filtersForm');
  const searchInput = document.getElementById('search');
  const topicFilter = document.getElementById('topicFilter');
  const dateFilter = document.getElementById('dateFilter');

  topicFilter.addEventListener('change', () => form.submit());
  dateFilter.addEventListener('change', () => form.submit());

  let searchTimeout;
  searchInput.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      form.submit();
    }, 600); 
  });

  // WebGL —Ñ–æ–Ω
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('bg'), alpha: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.position.z = 5;

  const geometry = new THREE.TorusGeometry(2, 0.5, 16, 100);
  const material = new THREE.MeshStandardMaterial({ color: 0x7f5af0 });
  const torus = new THREE.Mesh(geometry, material);
  scene.add(torus);

  const light = new THREE.PointLight(0xffffff, 1);
  light.position.set(5,5,5);
  scene.add(light);

  function animate() {
    requestAnimationFrame(animate);
    torus.rotation.x += 0.01;
    torus.rotation.y += 0.005;
    renderer.render(scene, camera);
  }
  animate();

  // –ü–∞—Å—Ö–∞–ª–∫–∞ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  const easterModal = document.getElementById("easter-modal");
  const githubBtn = document.getElementById("github-btn");
  const closeEasterBtn = document.getElementById("close-easter");
  const header = document.getElementById("header");
  const body = document.body;
  let glitchOverlay = null;
  let easterActive = false;
  let glitchInterval = null;

  function createGlitchOverlay() {
    glitchOverlay = document.createElement("div");
    glitchOverlay.style.position = "fixed";
    glitchOverlay.style.top = "0";
    glitchOverlay.style.left = "0";
    glitchOverlay.style.width = "100vw";
    glitchOverlay.style.height = "100vh";
    glitchOverlay.style.pointerEvents = "none";
    glitchOverlay.style.zIndex = "9999";
    glitchOverlay.style.mixBlendMode = "screen";
    glitchOverlay.style.background = `
      repeating-linear-gradient(
        45deg,
        rgba(255, 0, 200, 0.07),
        rgba(255, 0, 200, 0.07) 2px,
        transparent 2px,
        transparent 4px
      ),
      repeating-linear-gradient(
        -45deg,
        rgba(0, 255, 255, 0.07),
        rgba(0, 255, 255, 0.07) 2px,
        transparent 2px,
        transparent 4px
      )
    `;
    glitchOverlay.style.animation = "glitchOverlayAnim 0.3s infinite";
    document.body.appendChild(glitchOverlay);
  }
  function removeGlitchOverlay() {
    if (glitchOverlay && glitchOverlay.parentNode) {
      glitchOverlay.parentNode.removeChild(glitchOverlay);
      glitchOverlay = null;
    }
  }

  // –≠—Ñ—Ñ–µ–∫—Ç –¥—Ä–æ–∂–∞–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ ‚Äî —Å–¥–≤–∏–≥–∞–µ–º body —Å–ª—É—á–∞–π–Ω–æ
  function startScreenShake() {
    glitchInterval = setInterval(() => {
      const x = (Math.random() - 0.5) * 10;
      const y = (Math.random() - 0.5) * 10;
      body.style.transform = `translate(${x}px, ${y}px)`;
    }, 50);
  }
  function stopScreenShake() {
    clearInterval(glitchInterval);
    body.style.transform = "";
  }

  // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
  function activateEasterEgg() {
    if (easterActive) return;
    easterActive = true;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    easterModal.classList.add("show");

    // –î–µ–ª–∞–µ–º –¥—Ä–æ–∂–∞–Ω–∏–µ –∏ –≥–ª–∏—Ç—á —ç—Ñ—Ñ–µ–∫—Ç
    body.classList.add("glitch-shake");
    startScreenShake();

    // –®–∞–ø–∫–∞ –ø–∞–¥–∞–µ—Ç –∏ –Ω–∞–∫–ª–æ–Ω—è–µ—Ç—Å—è
    header.classList.add("header-fall");

    // –§–∏–ª—å—Ç—Ä —Ü–≤–µ—Ç–∞ –¥–ª—è –≥–ª–∏—Ç—á–∞
    body.style.filter = "hue-rotate(50deg) saturate(1.7) contrast(1.5)";

    // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–∏—Ç—á-–ø–æ–ª–æ—Å—ã
    createGlitchOverlay();

    // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–∏—Ç—á –∫ –ø–æ—Å—Ç–∞–º –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è
    document.querySelectorAll(".post").forEach(post => post.classList.add("glitch-effect"));

    // –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É body, –Ω–æ —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—å main, —Å–±—Ä–æ—Å–∏–º overflow –Ω–∞ main
    body.style.overflow = "hidden";
    document.querySelector("main").style.overflow = "auto";

    // –§–æ–∫—É—Å–∏—Ä—É–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    easterModal.setAttribute("tabindex", "-1");
    easterModal.focus();
  }

  // –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–∞—Å—Ö–∞–ª–∫–∏
  function resetEasterEgg() {
    easterActive = false;
    easterModal.classList.remove("show");
    body.classList.remove("glitch-shake");
    stopScreenShake();
    header.classList.remove("header-fall");
    body.style.filter = "";
    removeGlitchOverlay();
    document.querySelectorAll(".post").forEach(post => post.classList.remove("glitch-effect"));

    body.style.overflow = "";
    document.querySelector("main").style.overflow = "";

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –≤ –ø–æ–∏—Å–∫
    search.focus();
  }

  githubBtn.onclick = () => window.open("https://github.com/ZSHTeam");
  closeEasterBtn.onclick = resetEasterEgg;

  // –õ–æ–≥–∏–∫–∞ –ø–æ –∫–ª–∞–≤–∏—à–∞–º ‚Äî –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Å—Ö–∞–ª–∫—É –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Shift + Z
  document.addEventListener("keydown", (e) => {
    if (e.key.toLowerCase() === "z" && e.shiftKey) {
      activateEasterEgg();
    }
  });

  // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–∫–Ω–∞
  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>

</body>
</html>
